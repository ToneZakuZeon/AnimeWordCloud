import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
from PIL import Image
from wordcloud import WordCloud, ImageColorGenerator, STOPWORDS

#removes unimportant words like (we, i, the, etc)
stopwords = set(STOPWORDS)

df = pd.read_csv("Anime\\MALratings.csv")
#excludes anime that have non-applicable ranking
df2 = df[df.Rank != "/A"]
df2['Rank'] = df2['Rank'].astype(int)
anime = df2.sort_values(by ="Rank", ascending=True)

del df
del df2

#change number based on how much anime you want included
anime = anime.head(1000)

text = " ".join(title for title in anime.Title)

#input image file path to use ask your mask for a wordcloud
color_mask = np.array(Image.open("CDownloads\\bocchi.png").convert('RGBA'))

'''
#use this to transform the background of an image for your wordcloud, only works with simple backgrounds
def transform_format(val):
    if val.any() == 0:
        return 255
    else:
        return val

#in the case your image forms an odd 2d array use this for loop to fix the shape    
for i in range(len(color_mask)):
   color_mask[i] = list(map(transform_format, color_mask[i]))
    #use this if it's an odd 3d array, uncall the line above
    for j in range(len(color_mask[i])):
        color_mask[i][j] = list(map(transform_format, color_mask[i][j]))
'''
#adjust the wordcloud here, if the font is too small then less popular words won't appear, 
#if the font is too big than words might not fit the shape, higher max words allows for more detail at the cost of time       
word_cloud = WordCloud(max_font_size= 12, collocations=False, 
background_color="black", max_words = 9000, 
mode="RGBA", stopwords=stopwords, mask = color_mask).generate(text)

image_colors = ImageColorGenerator(color_mask)
#adjust fig size to image resolution, ex: 1280x720 will be [12.8, 7.2]
plt.figure(figsize=[12.8, 7.2])
plt.imshow(word_cloud.recolor(color_func=image_colors), interpolation='bilinear', aspect="auto")
plt.axis("off")
#removes empty white borders
plt.tight_layout(pad=0)
plt.savefig("Downloads\\BocchiCloud.png", format="png")
plt.show()

